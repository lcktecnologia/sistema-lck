{% extends "base.html" %}
{% block content %}
<div class="container" style="max-width:980px">
  <div class="topbar">
    <div>
      <div style="font-size:28px;font-weight:1000">{{ os_row["numero_os"] }}</div>
      <div class="small">Status atual: <b>{{ os_row["status"] }}</b></div>
      <div class="small">A pagina pode demorar até 40 segundos para carregar.</div>
    </div>
    <a class="btn" style="min-width:auto" href="{{ url_for('consultar') }}">← Voltar</a>
  </div>

  {% if last_update %}
  <div class="card" style="border-color:rgba(0,188,212,.35);background:rgba(0,188,212,.10)">
    <div style="font-weight:1000;font-size:16px">✅ Última atualização</div>
    <div class="small" style="margin-top:8px">
      <b>{{ last_update["evento"] }}</b> • {{ last_update["dt"] }}<br>
      {{ last_update["descricao"] }}
    </div>
  </div>
  {% endif %}

  <div style="height:14px"></div>

  <div class="grid">
    <div class="card">
      <div style="font-weight:900">Equipamento</div>
      <div style="height:10px"></div>
      <div class="small">Tipo: <b>{{ os_row["equipamento_tipo"] or "-" }}</b></div>
      <div class="small">Marca/Modelo: <b>{{ (os_row["equip_marca"] or "-") ~ " / " ~ (os_row["equip_modelo"] or "-") }}</b></div>
      <div class="small">
        IMEI:
        {% if os_row["hide_equip_imei"]==1 %}<b>(oculto)</b>{% else %}<b>{{ os_row["equip_imei"] or "-" }}</b>{% endif %}
      </div>
      <div class="small">
        Serial:
        {% if os_row["hide_equip_serial"]==1 %}<b>(oculto)</b>{% else %}<b>{{ os_row["equip_serial"] or "-" }}</b>{% endif %}
      </div>
    </div>

    <div class="card">
      <div style="font-weight:900">Valores</div>
      <div style="height:10px"></div>
      {% if os_row["hide_valores"]==1 %}
        <div class="small"><b>(valores ocultos)</b></div>
      {% else %}
        <div class="small">Orçado: <b>R$ {{ "%.2f"|format(os_row["valor_orcado"] or 0) }}</b></div>
        <div class="small">Pago: <b>R$ {{ "%.2f"|format(os_row["valor_pago"] or 0) }}</b></div>
        <div class="small">Data Pagamento: <b>{{ os_row["data_pagamento"] or "-" }}</b></div>
      {% endif %}
    </div>
  </div>

  <div style="height:14px"></div>

  <div class="card">
    <div style="font-weight:900">Relato inicial</div>
    <div style="height:10px"></div>
    <div class="small"><b>Defeito relatado:</b> {{ os_row["defeito_relatado"] or "-" }}</div>
  </div>

  <div style="height:14px"></div>

  <div class="card">
    <div style="font-weight:900">Histórico (visível ao cliente)</div>
    <div style="height:10px"></div>
    <table class="table">
      <thead>
        <tr>
          <th>Data/Hora</th>
          <th>Evento</th>
          <th>Descrição</th>
        </tr>
      </thead>
      <tbody>
      {% for h in historico %}
        <tr>
          <td class="small">{{ h["dt"] }}</td>
          <td><span class="pill">{{ h["evento"] }}</span></td>
          <td class="small">{{ h["descricao"] }}</td>
        </tr>
      {% else %}
        <tr><td colspan="3" class="small">Sem atualizações visíveis ainda.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
